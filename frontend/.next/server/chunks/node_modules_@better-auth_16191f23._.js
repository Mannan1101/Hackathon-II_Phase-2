module.exports=[39127,e=>{"use strict";function t(e){switch(e){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw Error(`Unsupported alphabet: ${e}`)}}function r(...e){let a=e.map(t).join("");if(0===a.length)throw Error("No valid characters provided for random string generation.");let n=a.length;return(e,...r)=>{let i;if(e<=0)throw Error("Length must be a positive integer.");let d=a,o=n;r.length>0&&(o=(d=r.map(t).join("")).length);let s=Math.floor(256/o)*o,l=new Uint8Array(2*e),u=l.length,f="",c=u;for(;f.length<e;)c>=u&&(crypto.getRandomValues(l),c=0),(i=l[c++])<s&&(f+=d[i%o]);return f}}e.s(["createRandomStringGenerator",()=>r])},63206,e=>{"use strict";let t=Object.create(null),r=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?t:globalThis),a=new Proxy(t,{get:(e,a)=>r()[a]??t[a],has:(e,a)=>a in r()||a in t,set:(e,t,a)=>(r(!0)[t]=a,!0),deleteProperty(e,t){if(!t)return!1;let a=r(!0);return delete a[t],!0},ownKeys:()=>Object.keys(r(!0))}),n="undefined"!=typeof process&&process.env&&"production"||"",i="production"===n,d=()=>"dev"===n||"development"===n,o=()=>{var e;return"test"===n||!!(e=a.TEST)&&"false"!==e};function s(e,t){return"undefined"!=typeof process&&process.env?process.env[e]??t:"undefined"!=typeof Deno?Deno.env.get(e)??t:"undefined"!=typeof Bun?Bun.env[e]??t:t}function l(e,t=!0){let r=s(e);return r?"0"!==r&&"false"!==r.toLowerCase()&&""!==r:t}let u=Object.freeze({get BETTER_AUTH_SECRET(){return s("BETTER_AUTH_SECRET")},get AUTH_SECRET(){return s("AUTH_SECRET")},get BETTER_AUTH_TELEMETRY(){return s("BETTER_AUTH_TELEMETRY")},get BETTER_AUTH_TELEMETRY_ID(){return s("BETTER_AUTH_TELEMETRY_ID")},get NODE_ENV(){return s("NODE_ENV","development")},get PACKAGE_VERSION(){return s("PACKAGE_VERSION","0.0.0")},get BETTER_AUTH_TELEMETRY_ENDPOINT(){return s("BETTER_AUTH_TELEMETRY_ENDPOINT","https://telemetry.better-auth.com/v1/track")}}),f={eterm:4,cons25:4,console:4,cygwin:4,dtterm:4,gnome:4,hurd:4,jfbterm:4,konsole:4,kterm:4,mlterm:4,mosh:24,putty:4,st:4,"rxvt-unicode-24bit":24,terminator:24,"xterm-kitty":24},c=new Map(Object.entries({APPVEYOR:8,BUILDKITE:8,CIRCLECI:24,DRONE:8,GITEA_ACTIONS:24,GITHUB_ACTIONS:24,GITLAB_CI:8,TRAVIS:8})),m=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function p(){if(void 0!==s("FORCE_COLOR"))switch(s("FORCE_COLOR")){case"":case"1":case"true":return 4;case"2":return 8;case"3":return 24;default:return 1}if(void 0!==s("NODE_DISABLE_COLORS")&&""!==s("NODE_DISABLE_COLORS")||void 0!==s("NO_COLOR")&&""!==s("NO_COLOR")||"dumb"===s("TERM"))return 1;if(s("TMUX"))return 24;if("TF_BUILD"in a&&"AGENT_NAME"in a)return 4;if("CI"in a){for(let{0:e,1:t}of c)if(e in a)return t;return"codeship"===s("CI_NAME")?8:1}if("TEAMCITY_VERSION"in a)return null!==/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(s("TEAMCITY_VERSION"))?4:1;switch(s("TERM_PROGRAM")){case"iTerm.app":if(!s("TERM_PROGRAM_VERSION")||null!==/^[0-2]\./.exec(s("TERM_PROGRAM_VERSION")))return 8;return 24;case"HyperTerm":case"MacTerm":return 24;case"Apple_Terminal":return 8}if("truecolor"===s("COLORTERM")||"24bit"===s("COLORTERM"))return 24;if(s("TERM")){if(null!==/truecolor/.exec(s("TERM")))return 24;if(null!==/^xterm-256/.exec(s("TERM")))return 8;let e=s("TERM").toLowerCase();if(f[e])return f[e];if(m.some(t=>null!==t.exec(e)))return 4}return s("COLORTERM")?4:1}let y={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",undim:"\x1b[22m",underscore:"\x1b[4m",blink:"\x1b[5m",reverse:"\x1b[7m",hidden:"\x1b[8m",fg:{black:"\x1b[30m",red:"\x1b[31m",green:"\x1b[32m",yellow:"\x1b[33m",blue:"\x1b[34m",magenta:"\x1b[35m",cyan:"\x1b[36m",white:"\x1b[37m"},bg:{black:"\x1b[40m",red:"\x1b[41m",green:"\x1b[42m",yellow:"\x1b[43m",blue:"\x1b[44m",magenta:"\x1b[45m",cyan:"\x1b[46m",white:"\x1b[47m"}},g=["debug","info","success","warn","error"];function b(e,t){return g.indexOf(t)>=g.indexOf(e)}let N={info:y.fg.blue,success:y.fg.green,warn:y.fg.yellow,error:y.fg.red,debug:y.fg.magenta},A=e=>{let t=e?.disabled!==!0,r=e?.level??"error",a=e?.disableColors!==void 0?!e.disableColors:1!==p();return{...Object.fromEntries(g.map(n=>[n,(...[i,...d])=>((n,i,d=[])=>{let o;if(!t||!b(r,n))return;let s=(o=new Date().toISOString(),a?`${y.dim}${o}${y.reset} ${N[n]}${n.toUpperCase()}${y.reset} ${y.bright}[Better Auth]:${y.reset} ${i}`:`${o} ${n.toUpperCase()} [Better Auth]: ${i}`);e&&"function"==typeof e.log?e.log("success"===n?"info":n,i,...d):"error"===n?console.error(s,...d):"warn"===n?console.warn(s,...d):console.log(s,...d)})(n,i,d)])),get level(){return r}}},E=A();e.s(["a",()=>b,"c",()=>a,"d",()=>d,"f",()=>i,"i",()=>E,"l",()=>l,"m",()=>n,"n",()=>A,"o",()=>p,"p",()=>o,"r",()=>g,"s",()=>u,"t",()=>y,"u",()=>s])},57547,25983,e=>{"use strict";var t=e.i(63206),r=e.i(39127);function a(e){return e}let n=e=>(0,r.createRandomStringGenerator)("a-z","A-Z","0-9")(e||32);function i(e){try{if("string"!=typeof e)return e;return JSON.parse(e,function(e,t){if("string"==typeof t&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(t)){let e=new Date(t);if(!isNaN(e.getTime()))return e}return t})}catch(e){return t.i.error("Error parsing JSON",{error:e}),null}}function d(e){return e.charAt(0).toUpperCase()+e.slice(1)}e.s(["i",()=>a,"n",()=>i,"r",()=>n,"t",()=>d],57547);let o={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"Invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account.",CROSS_SITE_NAVIGATION_LOGIN_BLOCKED:"Cross-site navigation login blocked. This request appears to be a CSRF attack.",VERIFICATION_EMAIL_NOT_ENABLED:"Verification email isn't enabled",EMAIL_ALREADY_VERIFIED:"Email is already verified",EMAIL_MISMATCH:"Email mismatch",SESSION_NOT_FRESH:"Session is not fresh",LINKED_ACCOUNT_ALREADY_EXISTS:"Linked account already exists",INVALID_ORIGIN:"Invalid origin",INVALID_CALLBACK_URL:"Invalid callbackURL",INVALID_REDIRECT_URL:"Invalid redirectURL",INVALID_ERROR_CALLBACK_URL:"Invalid errorCallbackURL",INVALID_NEW_USER_CALLBACK_URL:"Invalid newUserCallbackURL",MISSING_OR_NULL_ORIGIN:"Missing or null Origin",CALLBACK_URL_REQUIRED:"callbackURL is required",FAILED_TO_CREATE_VERIFICATION:"Unable to create verification",FIELD_NOT_ALLOWED:"Field not allowed to be set",ASYNC_VALIDATION_NOT_SUPPORTED:"Async validation is not supported",VALIDATION_ERROR:"Validation Error",MISSING_FIELD:"Field is required"};var s=class extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}};e.s(["n",()=>o,"t",()=>s],25983)},24989,e=>{"use strict";let t=e=>{let t=(e.plugins??[]).reduce((e,t)=>{let r=t.schema;if(!r)return e;for(let[t,a]of Object.entries(r))e[t]={fields:{...e[t]?.fields,...a.fields},modelName:a.modelName||t};return e},{}),r=e.rateLimit?.storage==="database",a={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:n,session:i,account:d,verification:o,...s}=t,l={session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,index:!0},...i?.fields,...e.session?.additionalFields},order:2}};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified",input:!1},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,onUpdate:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...n?.fields,...e.user?.additionalFields},order:1},...!e.secondaryStorage||e.session?.storeSessionInDatabase?l:{},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId",index:!0},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.refreshTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},...d?.fields,...e.account?.additionalFields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier",index:!0},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!0,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,defaultValue:()=>new Date,onUpdate:()=>new Date,fieldName:e.verification?.fields?.updatedAt||"updatedAt"},...o?.fields,...e.verification?.additionalFields},order:4},...s,...r?a:{}}};e.s(["t",()=>t])},12407,e=>{"use strict";var t=e.i(24989),r=e.i(63206),a=e.i(57547),n=e.i(25983);let i=({usePlural:e,schema:t})=>r=>{if(e&&"s"===r.charAt(r.length-1)){let e=r.slice(0,-1),a=t[e]?e:void 0;if(a||(a=Object.entries(t).find(([t,r])=>r.modelName===e)?.[0]),a)return a}let a=t[r]?r:void 0;if(a||(a=Object.entries(t).find(([e,t])=>t.modelName===r)?.[0]),!a)throw new n.t(`Model "${r}" not found in schema`);return a},d=({schema:e,usePlural:t})=>{let r=i({schema:e,usePlural:t});return({field:t,model:a})=>{if("id"===t||"_id"===t)return"id";let i=r(a),d=e[i]?.fields[t];if(!d){let r=Object.entries(e[i].fields).find(([e,r])=>r.fieldName===t);r&&(d=r[1],t=r[0])}if(!d)throw new n.t(`Field ${t} not found in model ${i}`);return t}},o=({usePlural:e,schema:t,disableIdGeneration:n,options:d,customIdGenerator:o,supportsUUIDs:s})=>{let l=i({usePlural:e,schema:t});return({customModelName:e,forceAllowId:t})=>{let i=d.advanced?.database?.useNumberId||d.advanced?.database?.generateId==="serial",u=d.advanced?.database?.generateId==="uuid",f=!n&&(!i||!!t)&&(!u||!s),c=l(e??"id");return{type:i?"number":"string",required:!!f,...f?{defaultValue(){if(n)return;let e=d.advanced?.database?.generateId;if(!1!==e&&!i)return"function"==typeof e?e({model:c}):o?o({model:c}):"uuid"===e?crypto.randomUUID():(0,a.r)()}}:{},transform:{input:e=>{if(e){if(i){let t=Number(e);if(isNaN(t))return;return t}if(u){if(f&&!t)return e;if(n||s)return;if(t&&"string"==typeof e)if(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e))return e;else{let e=Error().stack?.split("\n").filter((e,t)=>1!==t).join("\n").replace("Error:","");r.i.warn("[Adapter Factory] - Invalid UUID value for field `id` provided when `forceAllowId` is true. Generating a new UUID.",e)}return"string"==typeof e||s?void 0:crypto.randomUUID()}return e}},output:e=>{if(e)return String(e)}}}}},s=({schema:e,usePlural:t})=>{let r=i({schema:e,usePlural:t}),a=d({schema:e,usePlural:t});return function({model:t,field:n}){let i=r(t),d=a({model:i,field:n});return e[i]?.fields[d]?.fieldName||d}},l=({usePlural:e,schema:t})=>{let r=i({schema:t,usePlural:e});return a=>{let n=r(a);return t&&t[n]&&t[n].modelName!==a?e?`${t[n].modelName}s`:t[n].modelName:e?`${a}s`:a}},u=[],f=-1,c=({adapter:e,config:c})=>b=>{let N=Math.random().toString(36).substring(2,15),A={...c,supportsBooleans:c.supportsBooleans??!0,supportsDates:c.supportsDates??!0,supportsJSON:c.supportsJSON??!1,adapterName:c.adapterName??c.adapterId,supportsNumericIds:c.supportsNumericIds??!0,supportsUUIDs:c.supportsUUIDs??!1,supportsArrays:c.supportsArrays??!1,transaction:c.transaction??!1,disableTransformInput:c.disableTransformInput??!1,disableTransformOutput:c.disableTransformOutput??!1,disableTransformJoin:c.disableTransformJoin??!1};if((b.advanced?.database?.useNumberId===!0||b.advanced?.database?.generateId==="serial")&&!1===A.supportsNumericIds)throw new n.t(`[${A.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);let E=(0,t.t)(b),I=(...e)=>{if(!0===A.debugLogs||"object"==typeof A.debugLogs){let t=(0,r.n)({level:"info"});if("object"==typeof A.debugLogs&&"isRunningAdapterTests"in A.debugLogs){A.debugLogs.isRunningAdapterTests&&(e.shift(),u.push({instance:N,args:e}));return}if("object"!=typeof A.debugLogs||!A.debugLogs.logCondition||A.debugLogs.logCondition?.())if("object"==typeof e[0]&&"method"in e[0]){let r=e.shift().method;if("object"==typeof A.debugLogs){if("create"===r&&!A.debugLogs.create)return;else if("update"===r&&!A.debugLogs.update)return;else if("updateMany"===r&&!A.debugLogs.updateMany)return;else if("findOne"===r&&!A.debugLogs.findOne)return;else if("findMany"===r&&!A.debugLogs.findMany)return;else if("delete"===r&&!A.debugLogs.delete)return;else if("deleteMany"===r&&!A.debugLogs.deleteMany)return;else if("count"===r&&!A.debugLogs.count)return}t.info(`[${A.adapterName}]`,...e)}else t.info(`[${A.adapterName}]`,...e)}},T=(0,r.n)(b.logger),O=i({usePlural:A.usePlural,schema:E}),_=d({usePlural:A.usePlural,schema:E}),h=l({usePlural:A.usePlural,schema:E}),R=s({schema:E,usePlural:A.usePlural}),$=o({schema:E,options:b,usePlural:A.usePlural,disableIdGeneration:A.disableIdGeneration,customIdGenerator:A.customIdGenerator,supportsUUIDs:A.supportsUUIDs}),L=(({usePlural:e,schema:t,options:r,customIdGenerator:a,disableIdGeneration:s})=>{let l=i({usePlural:e,schema:t}),u=d({usePlural:e,schema:t}),f=o({usePlural:e,schema:t,options:r,customIdGenerator:a,disableIdGeneration:s});return({model:e,field:r})=>{let a=l(e),i=u({field:r,model:a}),d=t[a].fields;d.id=f({customModelName:a});let o=d[i];if(!o)throw new n.t(`Field ${r} not found in model ${e}`);return o}})({schema:E,options:b,usePlural:A.usePlural,disableIdGeneration:A.disableIdGeneration,customIdGenerator:A.customIdGenerator}),w=async(e,t,r,a)=>{let n={},i=E[t].fields,d=A.mapKeysTransformInput??{},o=b.advanced?.database?.useNumberId||b.advanced?.database?.generateId==="serial";for(let s in i.id=$({customModelName:t,forceAllowId:a&&"id"in e}),i){let a=e[s],l=i[s],u=d[s]||i[s].fieldName||s;if(void 0===a&&(void 0===l.defaultValue&&!l.transform?.input&&!("update"===r&&l.onUpdate)||"update"===r&&!l.onUpdate))continue;if(l&&"date"===l.type&&!(a instanceof Date)&&"string"==typeof a)try{a=new Date(a)}catch{T.error("[Adapter Factory] Failed to convert string to date",{value:a,field:s})}let f=function(e,t,r){if("update"===r)return void 0===e&&void 0!==t.onUpdate?"function"==typeof t.onUpdate?t.onUpdate():t.onUpdate:e;return"create"===r&&(void 0===e||!0===t.required&&null===e)&&void 0!==t.defaultValue?"function"==typeof t.defaultValue?t.defaultValue():t.defaultValue:e}(a,l,r);l.transform?.input&&(f=await l.transform.input(f)),l.references?.field==="id"&&o?f=Array.isArray(f)?f.map(e=>null!==e?Number(e):null):null!==f?Number(f):null:!1===A.supportsJSON&&"object"==typeof f&&"json"===l.type||!1===A.supportsArrays&&Array.isArray(f)&&("string[]"===l.type||"number[]"===l.type)?f=JSON.stringify(f):!1===A.supportsDates&&f instanceof Date&&"date"===l.type?f=f.toISOString():!1===A.supportsBooleans&&"boolean"==typeof f&&(f=+!!f),A.customTransformInput&&(f=A.customTransformInput({data:f,action:r,field:u,fieldAttributes:l,model:h(t),schema:E,options:b})),void 0!==f&&(n[u]=f)}return n},D=async(e,t,r=[],n)=>{let i=async(e,t,r=[])=>{if(!e)return null;let n=A.mapKeysTransformOutput??{},i={},d=E[O(t)].fields;for(let o in d[Object.entries(n).find(([e,t])=>"id"===t)?.[0]??"id"]={type:b.advanced?.database?.useNumberId||b.advanced?.database?.generateId==="serial"?"number":"string"},d){if(r.length&&!r.includes(o))continue;let s=d[o];if(s){let d=s.fieldName||o,l=e[Object.entries(n).find(([e,t])=>t===d)?.[0]||d];s.transform?.output&&(l=await s.transform.output(l));let u=n[o]||o;"id"===d||s.references?.field==="id"?null!=l&&(l=String(l)):!1===A.supportsJSON&&"string"==typeof l&&"json"===s.type||!1===A.supportsArrays&&"string"==typeof l&&("string[]"===s.type||"number[]"===s.type)?l=(0,a.n)(l):!1===A.supportsDates&&"string"==typeof l&&"date"===s.type?l=new Date(l):!1===A.supportsBooleans&&"number"==typeof l&&"boolean"===s.type&&(l=1===l),A.customTransformOutput&&(l=A.customTransformOutput({data:l,field:u,fieldAttributes:s,select:r,model:h(t),schema:E,options:b})),i[u]=l}}return i};if(!n||0===Object.keys(n).length)return await i(e,t,r);t=O(t);let d=await i(e,t,r),o=Object.entries(n).map(([e,t])=>({modelName:h(e),defaultModelName:O(e),joinConfig:t}));if(!e)return null;for(let{modelName:r,defaultModelName:a,joinConfig:n}of o){let o=await (async()=>b.experimental?.joins?e[r]:await U({baseModel:t,baseData:d,joinModel:r,specificJoinConfig:n}))();null==o&&(o="one-to-one"===n.relation?null:[]),"one-to-many"!==n.relation||Array.isArray(o)||(o=[o]);let s=[];if(Array.isArray(o))for(let e of o){let t=await i(e,r,[]);s.push(t)}else{let e=await i(o,r,[]);s.push(e)}d[a]=("one-to-one"===n.relation?s[0]:s)??null}return d},v=({model:e,where:t,action:r})=>{if(!t)return;let a=A.mapKeysTransformInput??{};return t.map(t=>{let{field:i,value:d,operator:o="eq",connector:s="AND"}=t;if("in"===o&&!Array.isArray(d))throw new n.t("Value must be an array");let l=d,u=O(e),f=_({field:i,model:e}),c=a[f]||R({field:f,model:u}),m=L({field:f,model:u}),p=b.advanced?.database?.useNumberId||b.advanced?.database?.generateId==="serial";if(("id"===f||m.references?.field==="id")&&p&&(l=Array.isArray(d)?d.map(Number):Number(d)),"date"===m.type&&d instanceof Date&&!A.supportsDates&&(l=d.toISOString()),"boolean"!==m.type||"boolean"!=typeof d||A.supportsBooleans||(l=+!!d),"json"===m.type&&"object"==typeof d&&!A.supportsJSON)try{l=JSON.stringify(d)}catch(e){throw Error(`Failed to stringify JSON value for field ${c}`,{cause:e})}return A.customTransformInput&&(l=A.customTransformInput({data:l,fieldAttributes:m,field:c,model:h(e),schema:E,options:b,action:r})),{operator:o,connector:s,field:c,value:l}})},S=(e,t,r)=>{if(!t||0===Object.keys(t).length)return;let a={};for(let[i,d]of Object.entries(t)){let t,o,s;if(!d)continue;let l=O(i),u=O(e),f=Object.entries(E[l].fields).filter(([e,t])=>t.references&&O(t.references.model)===u),c=!0;if(f.length||(f=Object.entries(E[u].fields).filter(([e,t])=>t.references&&O(t.references.model)===l),c=!1),f.length){if(f.length>1)throw new n.t(`Multiple foreign keys found for model ${i} and base model ${e} while performing join operation. Only one foreign key is supported.`)}else throw new n.t(`No foreign key found for model ${i} and base model ${e} while performing join operation.`);let[m,p]=f[0];if(!p.references)throw new n.t(`No references found for foreign key ${m} on model ${i} while performing join operation.`);c?(t=R({model:e,field:s=p.references.field}),o=R({model:i,field:m})):(t=R({model:e,field:s=m}),o=R({model:i,field:p.references.field})),r&&!r.includes(s)&&r.push(s);let y="id"===o||(p.unique??!1),g=b.advanced?.database?.defaultFindManyLimit??100;y?g=1:"object"==typeof d&&"number"==typeof d.limit&&(g=d.limit),a[h(i)]={on:{from:t,to:o},limit:g,relation:y?"one-to-one":"one-to-many"}}return{join:a,select:r}},U=async({baseModel:e,baseData:t,joinModel:r,specificJoinConfig:a})=>{let n;if(!t)return t;let i=h(r),d=a.on.to,o=t[_({field:a.on.from,model:e})];if(null==o)return"one-to-one"===a.relation?null:[];let s=v({model:i,where:[{field:d,value:o,operator:"eq",connector:"AND"}],action:"findOne"});try{if("one-to-one"===a.relation)n=await M.findOne({model:i,where:s});else{let e=a.limit??b.advanced?.database?.defaultFindManyLimit??100;n=await M.findMany({model:i,where:s,limit:e})}}catch(e){throw T.error(`Failed to query fallback join for model ${i}:`,{where:s,limit:a.limit}),console.error(e),e}return n},M=e({options:b,schema:E,debugLog:I,getFieldName:R,getModelName:h,getDefaultModelName:O,getDefaultFieldName:_,getFieldAttributes:L,transformInput:w,transformOutput:D,transformWhereClause:v}),C=null,x={transaction:async e=>{if(!C)if(A.transaction)T.debug(`[${A.adapterName}] - Using provided transaction implementation.`),C=A.transaction;else C=e=>e(x);return C(e)},create:async({data:e,model:t,select:r,forceAllowId:a=!1})=>{let n=++f,i=h(t);t=O(t),"id"in e&&void 0!==e.id&&!a&&(T.warn(`[${A.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`),console.log(Error().stack?.split("\n").filter((e,t)=>1!==t).join("\n").replace("Error:","Create method with `id` being called at:")),e.id=void 0),I({method:"create"},`${m(n)} ${p(1,4)}`,`${y("create")} ${g("Unsafe Input")}:`,{model:i,data:e});let d=e;A.disableTransformInput||(d=await w(e,t,"create",a)),I({method:"create"},`${m(n)} ${p(2,4)}`,`${y("create")} ${g("Parsed Input")}:`,{model:i,data:d});let o=await M.create({data:d,model:i});I({method:"create"},`${m(n)} ${p(3,4)}`,`${y("create")} ${g("DB Result")}:`,{model:i,res:o});let s=o;return A.disableTransformOutput||(s=await D(o,t,r,void 0)),I({method:"create"},`${m(n)} ${p(4,4)}`,`${y("create")} ${g("Parsed Result")}:`,{model:i,data:s}),s},update:async({model:e,where:t,update:r})=>{let a=++f,n=h(e=O(e)),i=v({model:e,where:t,action:"update"});I({method:"update"},`${m(a)} ${p(1,4)}`,`${y("update")} ${g("Unsafe Input")}:`,{model:n,data:r});let d=r;A.disableTransformInput||(d=await w(r,e,"update")),I({method:"update"},`${m(a)} ${p(2,4)}`,`${y("update")} ${g("Parsed Input")}:`,{model:n,data:d});let o=await M.update({model:n,where:i,update:d});I({method:"update"},`${m(a)} ${p(3,4)}`,`${y("update")} ${g("DB Result")}:`,{model:n,data:o});let s=o;return A.disableTransformOutput||(s=await D(o,e,void 0,void 0)),I({method:"update"},`${m(a)} ${p(4,4)}`,`${y("update")} ${g("Parsed Result")}:`,{model:n,data:s}),s},updateMany:async({model:e,where:t,update:r})=>{let a=++f,n=h(e),i=v({model:e,where:t,action:"updateMany"});e=O(e),I({method:"updateMany"},`${m(a)} ${p(1,4)}`,`${y("updateMany")} ${g("Unsafe Input")}:`,{model:n,data:r});let d=r;A.disableTransformInput||(d=await w(r,e,"update")),I({method:"updateMany"},`${m(a)} ${p(2,4)}`,`${y("updateMany")} ${g("Parsed Input")}:`,{model:n,data:d});let o=await M.updateMany({model:n,where:i,update:d});return I({method:"updateMany"},`${m(a)} ${p(3,4)}`,`${y("updateMany")} ${g("DB Result")}:`,{model:n,data:o}),I({method:"updateMany"},`${m(a)} ${p(4,4)}`,`${y("updateMany")} ${g("Parsed Result")}:`,{model:n,data:o}),o},findOne:async({model:e,where:t,select:r,join:a})=>{let n,i=++f,d=h(e),o=v({model:e,where:t,action:"findOne"});e=O(e);let s=!0;if(A.disableTransformJoin)n=a;else{let t=S(e,a,r);t&&(n=t.join,r=t.select),!b.experimental?.joins&&n&&Object.keys(n).length>0&&(s=!1)}I({method:"findOne"},`${m(i)} ${p(1,3)}`,`${y("findOne")}:`,{model:d,where:o,select:r,join:n});let l=await M.findOne({model:d,where:o,select:r,join:s?n:void 0});I({method:"findOne"},`${m(i)} ${p(2,3)}`,`${y("findOne")} ${g("DB Result")}:`,{model:d,data:l});let u=l;return A.disableTransformOutput||(u=await D(l,e,r,n)),I({method:"findOne"},`${m(i)} ${p(3,3)}`,`${y("findOne")} ${g("Parsed Result")}:`,{model:d,data:u}),u},findMany:async({model:e,where:t,limit:r,sortBy:a,offset:n,join:i})=>{let d,o=++f,s=r??b.advanced?.database?.defaultFindManyLimit??100,l=h(e),u=v({model:e,where:t,action:"findMany"});e=O(e);let c=!0;if(A.disableTransformJoin)d=i;else{let t=S(e,i,void 0);t&&(d=t.join),!b.experimental?.joins&&d&&Object.keys(d).length>0&&(c=!1)}I({method:"findMany"},`${m(o)} ${p(1,3)}`,`${y("findMany")}:`,{model:l,where:u,limit:s,sortBy:a,offset:n,join:d});let N=await M.findMany({model:l,where:u,limit:s,sortBy:a,offset:n,join:c?d:void 0});I({method:"findMany"},`${m(o)} ${p(2,3)}`,`${y("findMany")} ${g("DB Result")}:`,{model:l,data:N});let E=N;return A.disableTransformOutput||(E=await Promise.all(N.map(async t=>await D(t,e,void 0,d)))),I({method:"findMany"},`${m(o)} ${p(3,3)}`,`${y("findMany")} ${g("Parsed Result")}:`,{model:l,data:E}),E},delete:async({model:e,where:t})=>{let r=++f,a=h(e),n=v({model:e,where:t,action:"delete"});e=O(e),I({method:"delete"},`${m(r)} ${p(1,2)}`,`${y("delete")}:`,{model:a,where:n}),await M.delete({model:a,where:n}),I({method:"delete"},`${m(r)} ${p(2,2)}`,`${y("delete")} ${g("DB Result")}:`,{model:a})},deleteMany:async({model:e,where:t})=>{let r=++f,a=h(e),n=v({model:e,where:t,action:"deleteMany"});e=O(e),I({method:"deleteMany"},`${m(r)} ${p(1,2)}`,`${y("deleteMany")} ${g("DeleteMany")}:`,{model:a,where:n});let i=await M.deleteMany({model:a,where:n});return I({method:"deleteMany"},`${m(r)} ${p(2,2)}`,`${y("deleteMany")} ${g("DB Result")}:`,{model:a,data:i}),i},count:async({model:e,where:t})=>{let r=++f,a=h(e),n=v({model:e,where:t,action:"count"});e=O(e),I({method:"count"},`${m(r)} ${p(1,2)}`,`${y("count")}:`,{model:a,where:n});let i=await M.count({model:a,where:n});return I({method:"count"},`${m(r)} ${p(2,2)}`,`${y("count")}:`,{model:a,data:i}),i},createSchema:M.createSchema?async(e,r)=>{let a=(0,t.t)(b);return b.secondaryStorage&&!b.session?.storeSessionInDatabase&&delete a.session,b.rateLimit&&"database"===b.rateLimit.storage&&(void 0===b.rateLimit.enabled||!0===b.rateLimit.enabled)&&(a.ratelimit={modelName:b.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:b.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:b.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:b.rateLimit.fields?.lastRequest??"lastRequest"}}}),M.createSchema({file:r,tables:a})}:void 0,options:{adapterConfig:A,...M.options??{}},id:A.adapterId,...A.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){u=u.filter(e=>e.instance!==N)},printDebugLogs(){let e=`â”€`.repeat(80),t=u.filter(e=>e.instance===N);0===t.length||console.log(...t.reverse().map(e=>(e.args[0]=`
${e.args[0]}`,[...e.args,"\n"])).reduce((e,t)=>[...t,...e],[`
${e}`]))}}}:{}};return x};function m(e){return 8>(0,r.o)()?`#${e}`:`${r.t.fg.magenta}#${e}${r.t.reset}`}function p(e,t){return`${r.t.bg.black}${r.t.fg.yellow}[${e}/${t}]${r.t.reset}`}function y(e){return`${r.t.bright}${e}${r.t.reset}`}function g(e){return`${r.t.dim}(${e})${r.t.reset}`}e.s(["createAdapterFactory",()=>c,"initGetFieldName",()=>s,"initGetModelName",()=>l])}];

//# sourceMappingURL=node_modules_%40better-auth_16191f23._.js.map